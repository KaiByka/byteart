<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Physics: Relativity (E=mc^2)</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
            font-family: 'Courier New', monospace;
        }

        canvas {
            display: block;
        }

        #ui {
            position: absolute;
            top: 20px;
            left: 20px;
            color: #fff;
            pointer-events: none;
            mix-blend-mode: exclusion;
        }

        h1 {
            margin: 0;
            font-size: 16px;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .sub {
            font-size: 10px;
            opacity: 0.7;
            margin-top: 4px;
        }
    </style>
</head>

<body>
    <div id="ui">
        <h1>Relativity</h1>
        <div class="sub">E = mcÂ² // Mass to Energy Conversion</div>
    </div>
    <canvas id="c"></canvas>
    <script>
        const canvas = document.getElementById('c');
        const ctx = canvas.getContext('2d');

        let width, height;
        let particles = [];
        const numParticles = 2000;

        let cx, cy;

        // Interaction
        let mouseX = 0, mouseY = 0;
        let isMouseDown = false;

        class Particle {
            constructor() {
                this.reset();
            }

            reset() {
                this.state = 'mass'; // 'mass' or 'energy'

                // Spawn in a dense cluster (Nucleus)
                const angle = Math.random() * Math.PI * 2;
                const r = Math.random() * 50; // Small radius

                this.x = cx + Math.cos(angle) * r;
                this.y = cy + Math.sin(angle) * r;

                this.vx = (Math.random() - 0.5) * 0.5;
                this.vy = (Math.random() - 0.5) * 0.5;

                this.history = []; // Trails
            }

            update() {
                if (this.state === 'mass') {
                    // 1. Gravity (Pull to center)
                    const dx = cx - this.x;
                    const dy = cy - this.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);

                    if (dist > 10) {
                        this.vx += dx * 0.0005;
                        this.vy += dy * 0.0005;
                    }

                    // 2. Friction (Binding Energy)
                    this.vx *= 0.95;
                    this.vy *= 0.95;

                    // 3. Interaction (Trigger fission)
                    if (isMouseDown) {
                        const mdx = this.x - mouseX;
                        const mdy = this.y - mouseY;
                        const mdist = Math.sqrt(mdx * mdx + mdy * mdy);

                        // Repel from mouse click (Neutron bombardment)
                        if (mdist < 100) {
                            this.vx += mdx * 0.1; // Huge force
                            this.vy += mdy * 0.1;
                        }
                    }

                    // Transition to Energy if escaped binding radius
                    if (dist > 120) {
                        this.state = 'energy';
                        // Explosive acceleration (c^2 multiplier simulation)
                        const angle = Math.atan2(this.y - cy, this.x - cx);
                        const speed = 10 + Math.random() * 10;
                        this.vx = Math.cos(angle) * speed;
                        this.vy = Math.sin(angle) * speed;
                    }

                } else {
                    // Energy State: Constant flight
                    // No gravity, no friction. Pure speed.

                    // Add Trail
                    this.history.push({ x: this.x, y: this.y });
                    if (this.history.length > 5) this.history.shift();

                    // Accelerate slightly visually
                    this.vx *= 1.01;
                    this.vy *= 1.01;

                    // Reset if off screen
                    if (this.x < -100 || this.x > width + 100 || this.y < -100 || this.y > height + 100) {
                        this.reset();
                    }
                }

                this.x += this.vx;
                this.y += this.vy;
            }

            draw() {
                if (this.state === 'mass') {
                    // Dense, dark matter
                    ctx.fillStyle = '#444';
                    ctx.fillRect(this.x, this.y, 2, 2);
                } else {
                    // Radiant energy
                    // Draw trail
                    ctx.beginPath();
                    ctx.moveTo(this.x, this.y);
                    for (let i = this.history.length - 1; i >= 0; i--) {
                        ctx.lineTo(this.history[i].x, this.history[i].y);
                    }

                    // Color shift based on speed
                    // Gold -> White -> Violet
                    const speed = Math.hypot(this.vx, this.vy);
                    let col = `rgba(255, 200, 50, 0.8)`;
                    if (speed > 15) col = `rgba(255, 255, 255, 0.9)`;
                    if (speed > 25) col = `rgba(200, 200, 255, 0.9)`;

                    ctx.strokeStyle = col;
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }
            }
        }

        function init() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
            cx = width / 2;
            cy = height / 2;

            particles = [];
            for (let i = 0; i < numParticles; i++) {
                particles.push(new Particle());
            }
        }

        function animate() {
            // Motion blur for energy feel
            ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
            ctx.fillRect(0, 0, width, height);

            // Glow
            ctx.shadowBlur = 0;

            particles.forEach(p => {
                p.update();
                p.draw();
            });

            // Draw Core Glow
            const grd = ctx.createRadialGradient(cx, cy, 0, cx, cy, 100);
            grd.addColorStop(0, 'rgba(50, 50, 50, 0.1)');
            grd.addColorStop(1, 'rgba(0, 0, 0, 0)');
            ctx.fillStyle = grd;
            ctx.fillRect(0, 0, width, height);

            reqId = requestAnimationFrame(animate);
        }

        // Optimization: Pause when hidden
        let reqId;
        document.addEventListener("visibilitychange", () => {
            if (document.hidden) {
                if (reqId) cancelAnimationFrame(reqId);
            } else {
                animate();
            }
        });

        window.addEventListener('resize', init);

        window.addEventListener('mousemove', e => {
            mouseX = e.clientX;
            mouseY = e.clientY;
        });
        window.addEventListener('mousedown', () => isMouseDown = true);
        window.addEventListener('mouseup', () => isMouseDown = false);

        // Touch
        window.addEventListener('touchstart', e => {
            mouseX = e.touches[0].clientX;
            mouseY = e.touches[0].clientY;
            isMouseDown = true;
            e.preventDefault();
        }, { passive: false });
        window.addEventListener('touchend', () => isMouseDown = false);

        init();
        animate();
    </script>
</body>

</html>